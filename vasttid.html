
<!DOCTYPE html>
<html>
  <head>
    <title>VästTid configuration</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, inital-scale=1">

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

  </head>
  <body>

  <div class="container block">
    <h1>VastTid configuration</h1>
    <p>
    Enter the stop names as you would in Västtrafiks "Reseplaneraren",
    the first returned stop will be used.
    You can optionally add up to three directions (stop names).
    The departure board will be filtered to only show departures
    that will pass any of those stops (after the chosen stop).
  </p><br />

    <div class="form-group" id="favorite_div_0">
      <label for="favoritestop_0" class="control-label"> Favorite stop 1 </label>
      <button onclick="removeStop(0);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_0">
    </div>
    <div style="margin-left:30px" id="favoritedirectiongroup_0">
      <div class="form-group" id="favoritedirection_div_0_0">
        <label for="favoritedirection_0_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(0,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_0_0" value="test">
      </div>
      <div class="form-group" id="favoritedirection_div_0_1" style="display:none">
        <label for="favoritedirection_0_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(0,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_0_1">
      </div>
      <div class="form-group" id="favoritedirection_div_0_2" style="display:none">
        <label  for="favoritedirection_0_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(0,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_0_2">
      </div>
      <button onclick="addDirection(0);" class="btn btn-success" type="button">+</button>
    </div>

    <div class="form-group" id="favorite_div_1" style="display:none">
      <label for="favoritestop_1" class="control-label"> Favorite stop 2 </label>
      <button onclick="moveupStop(1);" class="btn btn-info" type="button">&uarr;</button>
      <button onclick="removeStop(1);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_1">
    </div>
    <div style="margin-left:30px; display:none" id="favoritedirectiongroup_1">
      <div class="form-group" id="favoritedirection_div_1_0">
        <label for="favoritedirection_1_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(1,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_1_0">
      </div>
      <div class="form-group" id="favoritedirection_div_1_1" style="display:none">
        <label for="favoritedirection_1_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(1,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_1_1">
      </div>
      <div class="form-group" id="favoritedirection_div_1_2" style="display:none">
        <label for="favoritedirection_1_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(1,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_1_2">
      </div>
      <button onclick="addDirection(1);" class="btn btn-success" type="button">+</button>
    </div>

    <div class="form-group" id="favorite_div_2" style="display:none">
      <label for="favoritestop_2" class="control-label"> Favorite stop 3 </label>
      <button onclick="moveupStop(2);" class="btn btn-info" type="button">&uarr;</button>
      <button onclick="removeStop(2);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_2">
    </div>
    <div style="margin-left:30px; display:none" id="favoritedirectiongroup_2">
      <div class="form-group" id="favoritedirection_div_2_0">
        <label for="favoritedirection_2_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(2,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_2_0">
      </div>
      <div class="form-group" id="favoritedirection_div_2_1" style="display:none">
        <label for="favoritedirection_2_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(2,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_2_1">
      </div>
      <div class="form-group" id="favoritedirection_div_2_2" style="display:none">
        <label for="favoritedirection_2_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(2,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_2_2">
      </div>
      <button onclick="addDirection(2);" class="btn btn-success" type="button">+</button>
    </div>

    <div class="form-group" id="favorite_div_3" style="display:none">
      <label for="favoritestop_3" class="control-label"> Favorite stop 4 </label>
      <button onclick="moveupStop(3);" class="btn btn-info" type="button">&uarr;</button>
      <button onclick="removeStop(3);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_3">
    </div>
    <div style="margin-left:30px; display:none" id="favoritedirectiongroup_3">
      <div class="form-group" id="favoritedirection_div_3_0">
        <label for="favoritedirection_3_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(3,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_3_0">
      </div>
      <div class="form-group" id="favoritedirection_div_3_1" style="display:none">
        <label for="favoritedirection_3_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(3,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_3_1">
      </div>
      <div class="form-group" id="favoritedirection_div_3_2" style="display:none">
        <label for="favoritedirection_3_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(3,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_3_2">
      </div>
      <button onclick="addDirection(3);" class="btn btn-success" type="button">+</button>
    </div>

    <div class="form-group" id="favorite_div_4" style="display:none">
      <label for="favoritestop_4" class="control-label"> Favorite stop 5 </label>
      <button onclick="moveupStop(4);" class="btn btn-info" type="button">&uarr;</button>
      <button onclick="removeStop(4);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_4">
    </div>
    <div style="margin-left:30px; display:none" id="favoritedirectiongroup_4">
      <div class="form-group" id="favoritedirection_div_4_0">
        <label for="favoritedirection_4_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(4,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_4_0">
      </div>
      <div class="form-group" id="favoritedirection_div_4_1" style="display:none">
        <label for="favoritedirection_4_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(4,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_4_1">
      </div>
      <div class="form-group" id="favoritedirection_div_4_2" style="display:none">
        <label for="favoritedirection_4_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(4,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_4_2">
      </div>
      <button onclick="addDirection(4);" class="btn btn-success" type="button">+</button>
    </div>

    <div class="form-group" id="favorite_div_5" style="display:none">
      <label for="favoritestop_5" class="control-label"> Favorite stop 6 </label>
      <button onclick="moveupStop(5);" class="btn btn-info" type="button">&uarr;</button>
      <button onclick="removeStop(5);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_5">
    </div>
    <div style="margin-left:30px; display:none" id="favoritedirectiongroup_5">
      <div class="form-group" id="favoritedirection_div_5_0">
        <label for="favoritedirection_5_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(5,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_5_0">
      </div>
      <div class="form-group" id="favoritedirection_div_5_1" style="display:none">
        <label for="favoritedirection_5_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(5,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_5_1">
      </div>
      <div class="form-group" id="favoritedirection_div_5_2" style="display:none">
        <label for="favoritedirection_5_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(5,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_5_2">
      </div>
      <button onclick="addDirection(5);" class="btn btn-success" type="button">+</button>
    </div>

    <div class="form-group" id="favorite_div_6" style="display:none">
      <label for="favoritestop_6" class="control-label"> Favorite stop 7 </label>
      <button onclick="moveupStop(6);" class="btn btn-info" type="button">&uarr;</button>
      <button onclick="removeStop(6);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_6">
    </div>
    <div style="margin-left:30px; display:none" id="favoritedirectiongroup_6">
      <div class="form-group" id="favoritedirection_div_6_0">
        <label for="favoritedirection_6_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(6,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_6_0">
      </div>
      <div class="form-group" id="favoritedirection_div_6_1" style="display:none">
        <label for="favoritedirection_6_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(6,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_6_1">
      </div>
      <div class="form-group" id="favoritedirection_div_6_2" style="display:none">
        <label for="favoritedirection_6_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(6,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_6_2">
      </div>
      <button onclick="addDirection(6);" class="btn btn-success" type="button">+</button>
    </div>

    <div class="form-group" id="favorite_div_7" style="display:none">
      <label for="favoritestop_7" class="control-label"> Favorite stop 8 </label>
      <button onclick="moveupStop(7);" class="btn btn-info" type="button">&uarr;</button>
      <button onclick="removeStop(7);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_7">
    </div>
    <div style="margin-left:30px; display:none" id="favoritedirectiongroup_7">
      <div class="form-group" id="favoritedirection_div_7_0">
        <label for="favoritedirection_7_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(7,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_7_0">
      </div>
      <div class="form-group" id="favoritedirection_div_7_1" style="display:none">
        <label for="favoritedirection_7_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(7,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_7_1">
      </div>
      <div class="form-group" id="favoritedirection_div_7_2" style="display:none">
        <label for="favoritedirection_7_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(7,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_7_2">
      </div>
      <button onclick="addDirection(7);" class="btn btn-success" type="button">+</button>
    </div>

    <div class="form-group" id="favorite_div_8" style="display:none">
      <label for="favoritestop_8" class="control-label"> Favorite stop 9 </label>
      <button onclick="moveupStop(8);" class="btn btn-info" type="button">&uarr;</button>
      <button onclick="removeStop(8);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_8">
    </div>
    <div style="margin-left:30px; display:none" id="favoritedirectiongroup_8">
      <div class="form-group" id="favoritedirection_div_8_0">
        <label for="favoritedirection_8_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(8,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_8_0">
      </div>
      <div class="form-group" id="favoritedirection_div_8_1" style="display:none">
        <label for="favoritedirection_8_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(8,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_8_1">
      </div>
      <div class="form-group" id="favoritedirection_div_8_2" style="display:none">
        <label for="favoritedirection_8_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(8,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_8_2">
      </div>
      <button onclick="addDirection(8);" class="btn btn-success" type="button">+</button>
    </div>

    <div class="form-group" id="favorite_div_9" style="display:none">
      <label for="favoritestop_9" class="control-label"> Favorite stop 10 </label>
      <button onclick="moveupStop(9);" class="btn btn-info" type="button">&uarr;</button>
      <button onclick="removeStop(9);" class="btn btn-danger" type="button">-</button>
      <input class="form-control" id="favoritestop_9">
    </div>
    <div style="margin-left:30px; display:none" id="favoritedirectiongroup_9">
      <div class="form-group" id="favoritedirection_div_9_0">
        <label for="favoritedirection_9_0" class="control-label"> Direction (optional) </label>
        <button onclick="removeDirection(9,0);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_9_0">
      </div>
      <div class="form-group" id="favoritedirection_div_9_1" style="display:none">
        <label for="favoritedirection_9_1" class="control-label"> Direction (2nd) (optional) </label>
        <button onclick="removeDirection(9,1);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_9_1">
      </div>
      <div class="form-group" id="favoritedirection_div_9_2" style="display:none">
        <label for="favoritedirection_9_2" class="control-label"> Direction (3rd) (optional) </label>
        <button onclick="removeDirection(9,2);" class="btn btn-danger" type="button">-</button>
        <input class="form-control" id="favoritedirection_9_2">
      </div>
      <button onclick="addDirection(9);" class="btn btn-success" type="button">+</button>
    </div>


    <br>
    <button onclick="addStop();" class="btn btn-success" type="button">+</button>


    <br><br>
    <button type="submit" id="b-cancel" class="btn btn-default">Cancel</button>
    <button type="submit" id="b-submit" class="btn btn-default" >Save</button>


  </div>

  <script>
    var nextStopId = 1;
    var nextDirectionId = [1,1,1,1,1,1,1,1,1,1];

    var i;
    var j;
    var stop;
    var stopdir;
    var elm;
    var elm2;
    for (i=0;i<10;i++) {
      stop = decodeURI(getURLVariable('favoritestop_'+i));
      if (stop!==null && stop!==undefined && stop.length>0) {
        elm = document.getElementById('favoritestop_'+i);
        elm.value = stop;
        elm = document.getElementById('favorite_div_'+i);
        elm.style.display = 'block';
        elm = document.getElementById('favoritedirectiongroup_'+i);
        elm.style.display = 'block';
        for (j=0;j<=2;j++) {
          stopdir = decodeURI(getURLVariable('favoritedirection_'+i+'_'+j));
          if (stopdir!==null && stopdir!==undefined && stopdir.length>0) {
            elm = document.getElementById('favoritedirection_'+i+'_'+j);
            elm.value = stopdir;
            elm = document.getElementById('favoritedirection_div_'+i+'_'+j);
            elm.style.display = 'block';
          }
          else break;
        }
        nextDirectionId[i] = j+1;
      }
      else {
        break;
      }
    }
    nextStopId = i;

    function saveOptions() {
      var options = {'save' : 1};
      for (i=0; i<10; i++) {
        options['favoritestop_'+i] = $("#favoritestop_"+i).val();
        for (j=0; j<=2; j++) {
          options['favoritedirection_'+i+'_'+j] = $("#favoritedirection_"+i+"_"+j).val();
        }
      }
      /*
      var options = {
        'favoritestop_0' : $("#favoritestop_0").val(),
        'favoritestop_1' : $("#favoritestop_1").val(),
        'favoritedirection_0_1' : $("#favoritedirection_0_1").val(),
        'favoritedirection_0_2' : $("#favoritedirection_0_2").val(),
        'favoritedirection_0_3' : $("#favoritedirection_0_3").val(),
        'favoritedirection_1_1' : $("#favoritedirection_1_1").val(),
        'favoritedirection_1_2' : $("#favoritedirection_1_2").val(),
        'favoritedirection_1_3' : $("#favoritedirection_1_3").val(),
      }
      */
      return options;
    }

    // Get query variables
    function getQueryParam(variable, defaultValue) {
      // Find all URL parameters
      var query = location.search.substring(1);
      var vars = query.split('&');
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');

        // If the query variable parameter is found, decode it to use and return it for use
        if (pair[0] === variable) {
          return decodeURIComponent(pair[1]);
        }
      }
      return defaultValue || false;
    }

    function removeStop(stopId) {
      for (i=stopId; i<nextStopId-1; i++) {
        elm = document.getElementById('favoritestop_'+i);
        elm2 = document.getElementById('favoritestop_'+(i+1));
        elm.value = elm2.value;

        for (j=0; j<=2; j++) {
          elm = document.getElementById('favoritedirection_'+i+'_'+j);
          elm2 = document.getElementById('favoritedirection_'+(i+1)+'_'+j);
          elm.value = elm2.value;
          elm = document.getElementById('favoritedirection_div_'+i+'_'+j);
          elm2 = document.getElementById('favoritedirection_div_'+(i+1)+'_'+j);
          elm.style.display = elm2.style.display;
        }
        nextDirectionId[i] = nextDirectionId[i+1];
      }
      elm = document.getElementById('favoritestop_'+i);
      elm.value = "";
      for (j=0; j<=2; j++) {
        elm = document.getElementById('favoritedirection_'+i+'_'+j);
        elm.value = "";
        if (j>0) {
          elm = document.getElementById('favoritedirection_div_'+i+'_'+j);
          elm.style.display = 'none';
        }
      }
      nextDirectionId[i] = 1;
      nextStopId--;
    }

    function removeDirection(stopId,directionId) {
      for (i=directionId;i<nextDirectionId[stopId]-1;i++) {
        elm = document.getElementById('favoritedirection_'+stopId+'_'+i);
        elm2 = document.getElementById('favoritedirection_'+stopId+'_'+(i+1));
        elm.value = elm2.value;
      }
      elm = document.getElementById('favoritedirection_'+stopId+'_'+i);
      elm.value = "";

      if (i>0) {
        elm = document.getElementById('favoritedirection_div_'+stopId+'_'+i);
        elm.style.display = 'none';
        nextDirectionId[stopId]--;
      }

    }

    function addStop() {
      if (nextStopId>=10) {
        //maximum
        window.alert("Maximum ten favorite stops");
      }
      else {
        elm = document.getElementById('favorite_div_'+nextStopId);
        elm.style.display = 'block';
        elm = document.getElementById('favoritedirectiongroup_'+nextStopId);
        elm.style.display = 'block';
        nextStopId++;
      }
    }

    function addDirection(id) {
      if (nextDirectionId[id]>2) {
        // maximum
        window.alert("Maximum three directions per favorite");
      } else {
        elm = document.getElementById('favoritedirection_div_' + id + '_' + nextDirectionId[id]);
        elm.style.display = 'block';
        // handle maximum here?
        nextDirectionId[id]++;
      }
    }

    function moveupStop(stopId) {
      var preceding_stopId = stopId - 1;
      var temp;
      elm = document.getElementById('favoritestop_'+stopId);
      elm2 = document.getElementById('favoritestop_'+preceding_stopId);
      temp = elm.value;
      elm.value = elm2.value;
      elm2.value = temp;
      for (j=0; j<=2; j++) {
        elm = document.getElementById('favoritedirection_'+stopId+'_'+j);
        elm2 = document.getElementById('favoritedirection_'+preceding_stopId+'_'+j);
        temp = elm.value;
        elm.value = elm2.value;
        elm2.value = temp;
        elm = document.getElementById('favoritedirection_div_'+stopId+'_'+j);
        elm2 = document.getElementById('favoritedirection_div_'+preceding_stopId+'_'+j);
        temp = elm.style.display;
        elm.style.display = elm2.style.display;
        elm2.style.display = temp;
      }
      nextDirectionId[stopId] = nextDirectionId[preceding_stopId];
    }

    var submitButton = document.getElementById('b-submit');
    submitButton.addEventListener('click', function() {
      var return_to = getQueryParam('return_to', 'pebblejs://close#');
      var location = return_to + encodeURIComponent(JSON.stringify(saveOptions()));
      //window.alert(location);
      window.location.href = location;
    });

    var cancelButton = document.getElementById('b-cancel');
    cancelButton.addEventListener('click', function() {
      var return_to = getQueryParam('return_to', 'pebblejs://close');
      var location = return_to;
      //window.alert(location);
      window.location.href = location;
    });

    function getURLVariable(name) {
      name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
      var regexS = "[\\?&]"+name+"=([^&#]*)",
          regex = new RegExp(regexS),
          results = regex.exec(window.location.href);
      if (results == null) return "";
      else return results[1];
    }
  </script>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="js/bootstrap.min.js"></script>

  </body>
</html>
